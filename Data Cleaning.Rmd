---
title: "stats 133 project - data cleaning/processing"
author: "Caleb Williams"
date: '`r Sys.Date()`'
output: pdf_document
---
```{r}

library(dplyr)
library(tidyr)
library(tidytext)
library(tm)
library(syuzhet)
library(pdftools)
library(quanteda)
library(quanteda.corpora)
library(stringr)
library(ggplot2)
library(readtext)
library(reshape2)
library(wordcloud)
library(wordcloud2)
library(SnowballC)
library(purrr)
library(RColorBrewer)

```


```{r}
set.seed(133)

movie_text <- read.csv('/Users/calebwilliams/Downloads/stats133finalproject/title_year_text.csv')

head(movie_text, 10)

```

# Text Cleaning
```{r}

clean_text <- function(text) {
  text <- tolower(text)
  text <- removeNumbers(text)
  text <- removePunctuation(text) 
  text <- removeWords(text, stopwords("en"))
  text <- stripWhitespace(text)
  text <- stemDocument(text)
  
  # specific transformations
  text <- gsub("mmddyyyy", " ", text)

  return(text)
}

# apply cleaning function
movie_text$text <- sapply(movie_text$text, clean_text)

```


# Tokenization
```{r}
text_tokens <- movie_text %>%
  select(title, text) %>%              
  unnest_tokens(word, text)

```

# Convert to tf_idf format 
```{r}
text_tf_idf <- text_tokens %>%
  count(title, word) %>%   
  ungroup() %>%                      
  bind_tf_idf(word, title, n) %>%      
  arrange(desc(tf_idf))  


sample_n(text_tf_idf, 50)

```


# Export tf_idf format to csv
```{r}
write.csv(text_tf_idf, 'movie_texts_tf_idf.csv')
```

